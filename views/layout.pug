doctype html
html
  head
    title Quejas Entidades Públicas de Boyacá
    meta(charset="utf-8")
    meta(name="viewport" content="width=device-width, initial-scale=1")
    link(rel="stylesheet", href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css")
    link(rel="stylesheet", href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css")

  body
    nav.navbar.navbar-expand-lg.navbar-light.bg-light.shadow-sm.border-bottom
      .container
        a.navbar-brand.fw-semibold.text-primary(href="/") 
          i.bi.bi-building.me-2
          | Sistema de Quejas - Boyacá

        button.navbar-toggler(type="button", data-bs-toggle="collapse", data-bs-target="#navbarNav")
          span.navbar-toggler-icon

        #navbarNav.collapse.navbar-collapse
          ul.navbar-nav.ms-auto
            li.nav-item#listaQuejaItem(style="display: none;")
              a.nav-link(href='/complaints/' class=(activePage === 'lista' ? 'active fw-semibold text-dark' : '')) 
                i.bi.bi-list-ul.me-1
                | Lista de Quejas
            li.nav-item
              a.nav-link(href='/registrar' class=(activePage === 'registrar' ? 'active fw-semibold text-dark' : ''))
                i.bi.bi-pencil-square.me-1
                | Registrar Queja
            li.nav-item.dropdown#reportesItem(style="display: none;")
              a.nav-link.dropdown-toggle(href='#', id='reportesDropdown', role='button', data-bs-toggle='dropdown', aria-expanded='false')
                i.bi.bi-bar-chart.me-1
                | Reportes
              ul.dropdown-menu(aria-labelledby='reportesDropdown')
                li
                  a.dropdown-item(href='/complaints-by-entity')
                    i.bi.bi-pie-chart.me-2
                    | Quejas por Entidad
                li
                  a.dropdown-item(href='/complaints-history')
                    i.bi.bi-clock-history.me-2
                    | Historial de Cambios

          ul.navbar-nav.ms-3
            li.nav-item.dropdown#userNavContainer
              a.btn.btn-outline-primary.fw-semibold(href='/login' id="loginBtn")
                i.bi.bi-box-arrow-in-right.me-1
                | Iniciar sesión

    .container.mt-4
      block content

    script(src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js")
    script.
      document.addEventListener('DOMContentLoaded', function() {
        const userEmail = localStorage.getItem('userEmail');
        const userNavContainer = document.getElementById('userNavContainer');
        const loginBtn = document.getElementById('loginBtn');
        const listaQuejaItem = document.getElementById('listaQuejaItem');
        const reportesItem = document.getElementById('reportesItem');
        const reportesDropdown = document.getElementById('reportesDropdown');

        if (userEmail) {
          loginBtn.style.display = 'none';

          userNavContainer.innerHTML = `
            <a class="nav-link dropdown-toggle text-dark fw-semibold" href="#" id="userMenu" role="button" data-bs-toggle="dropdown">
              <i class="bi bi-person-circle me-1"></i> ${userEmail}
            </a>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userMenu">
              <li class="text-center text-muted small px-3 py-1">${userEmail}</li>
              <li><hr class="dropdown-divider"></li>
              <li><a class="dropdown-item text-danger" id="logoutBtn" href="#">
                <i class="bi bi-box-arrow-right me-2"></i> Cerrar sesión
              </a></li>
            </ul>`;

          listaQuejaItem.style.display = 'block';
          reportesItem.style.display = 'block';

       
    
          document.getElementById('logoutBtn').addEventListener('click', async (e) => {
            e.preventDefault();
            try {
              const response = await fetch('/api/logout', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email: userEmail }),
              });

              if (response.ok) {
                localStorage.removeItem('userEmail');
                window.location.href = '/';
              } else {
                alert('Error al cerrar sesión');
              }
            } catch (err) {
              console.error('Error:', err);
              alert('No se pudo cerrar la sesión');
            }
          });
        }
      });