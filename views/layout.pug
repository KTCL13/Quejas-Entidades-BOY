doctype html
html
  head
    title Quejas Entidades Públicas de Boyacá
    meta(charset="utf-8")
    meta(name="viewport" content="width=device-width, initial-scale=1")
    link(rel="stylesheet", href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css")
    link(rel="stylesheet", href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css")
    script(src="https://www.google.com/recaptcha/api.js?render=6LeBKKkrAAAAAObCxLb511gIotGRecWMZZOEZhRg")

  body
   
    nav.navbar.navbar-expand-lg.navbar-light.bg-light.shadow-sm.border-bottom
      .container
        a.navbar-brand.fw-semibold.text-primary(href="#") 
          i.bi.bi-building.me-2
          | Sistema de Quejas - Boyacá

        button.navbar-toggler(type="button", data-bs-toggle="collapse", data-bs-target="#navbarNav")
          span.navbar-toggler-icon

        #navbarNav.collapse.navbar-collapse
          ul.navbar-nav.ms-auto
            li.nav-item
              a.nav-link(href='/' class=(activePage === 'lista' ? 'active fw-semibold text-dark' : '')) 
                i.bi.bi-list-ul.me-1
                | Lista de Quejas
            li.nav-item
              a.nav-link(href='/api/complaints/registrar' class=(activePage === 'registrar' ? 'active fw-semibold text-dark' : ''))
                i.bi.bi-pencil-square.me-1
                | Registrar Queja
            li.nav-item
              a.nav-link#linkReporte(href='/api/reports' class=(activePage === 'reportes' ? 'active fw-semibold text-dark' : ''))
                i.bi.bi-bar-chart.me-1
                | Reportes

          
          ul.navbar-nav.ms-3
            li.nav-item.dropdown
              if user
                a.nav-link.dropdown-toggle.text-dark.fw-semibold(href='#', id='userMenu', role='button', data-bs-toggle='dropdown')
                  i.bi.bi-person-circle.me-1
                  | Usuario activo
                ul.dropdown-menu.dropdown-menu-end(aria-labelledby='userMenu')
                  li.text-center.text-muted.small.px-3.py-1
                    | #{user.nombre || user.email}
                  li
                    hr.dropdown-divider
                  li
                    a.dropdown-item.text-danger(href='/logout')
                      i.bi.bi-box-arrow-right.me-2
                      | Cerrar sesión
              else
                a.btn.btn-outline-primary.fw-semibold(href='/login')
                  i.bi.bi-box-arrow-in-right.me-1
                  | Iniciar sesión

    
    .container.mt-4
      block content

    
    footer.bg-light.text-center.py-3.mt-5.border-top
      small.text-muted © 2025 Gobernación de Boyacá · Sistema de Quejas y Reclamos

    
    script(src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js")
    script.
      document.addEventListener('DOMContentLoaded', () => {
        const linkReporte = document.getElementById('linkReporte');
        if (linkReporte) {
          linkReporte.addEventListener('click', async (e) => {
            try {
              await fetch('/api/reports/ver');
              console.log("Correo enviado automáticamente al entrar en reportes");
            } catch (err) {
              console.error("Error al enviar correo automático:", err);
            }
          });
        }
      });
